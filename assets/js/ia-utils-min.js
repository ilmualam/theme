/*! PBT Performance Utils v2.0 - Enhanced Performance Features | (c) 2025 | Minified */
!function(e){"use strict";const t={metrics:{loadStart:performance.now(),scriptsLoaded:0,imagesLoaded:0,totalImages:0},init(){this.setupCriticalResourceHints(),this.setupAdvancedLazyLoading(),this.setupServiceWorker(),this.setupPerformanceObserver(),this.optimizeScrollPerformance(),this.setupPrefetching()},setupCriticalResourceHints(){this.preloadResource("/fonts/inter-var.woff2","font","font/woff2"),this.preconnect("https://blogger.googleusercontent.com"),this.preconnect("https://resources.blogblog.com"),this.preconnect("https://www.google-analytics.com")},preloadResource(e,t,n=null){const o=document.createElement("link");o.rel="preload",o.href=e,o.as=t,n&&(o.type=n),"font"===t&&(o.crossOrigin="anonymous"),document.head.appendChild(o)},preconnect(e){const t=document.createElement("link");t.rel="preconnect",t.href=e,t.crossOrigin="anonymous",document.head.appendChild(t)},setupAdvancedLazyLoading(){const e={immediateSelector:".hero img, .featured img, .post:first-child img",highPrioritySelector:".post:nth-child(-n+3) img",normalPrioritySelector:"img[data-src], .thumbnail[data-src]",lowPrioritySelector:".sidebar img, .footer img"};this.loadImagesImmediately(e.immediateSelector),setTimeout(()=>this.setupIntersectionObserver(e.highPrioritySelector,"0px"),0),setTimeout(()=>this.setupIntersectionObserver(e.normalPrioritySelector,"50px"),100),setTimeout(()=>this.setupIntersectionObserver(e.lowPrioritySelector,"200px"),500)},loadImagesImmediately(e){document.querySelectorAll(e).forEach(e=>{e.dataset.src&&(e.src=e.dataset.src,e.removeAttribute("data-src"))})},setupIntersectionObserver(e,t){const n=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(this.loadImage(e.target),n.unobserve(e.target))})},{rootMargin:t,threshold:.01});document.querySelectorAll(e).forEach(e=>{e.dataset.src&&n.observe(e)})},loadImage(e){const t=e.dataset.src;if(!t)return;this.metrics.totalImages++;const n=new Image;n.onload=()=>{"IMG"===e.tagName?e.src=t:e.style.backgroundImage=`url('${t}')`,e.classList.add("loaded"),e.removeAttribute("data-src"),this.metrics.imagesLoaded++,this.updatePerformanceMetrics()},n.onerror=()=>{e.classList.add("error"),console.warn("Failed to load image:",t)},n.src=t},setupServiceWorker(){"serviceWorker"in navigator&&"https:"===window.location.protocol&&navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(e=>{console.log("Service Worker registered:",e.scope)}).catch(e=>{console.log("Service Worker registration failed:",e)})},setupPerformanceObserver(){if("PerformanceObserver"in window){try{new PerformanceObserver(e=>{const t=e.getEntries()[e.getEntries().length-1];console.log("LCP:",t.startTime)}).observe({entryTypes:["largest-contentful-paint"]})}catch(e){}try{new PerformanceObserver(e=>{e.getEntries().forEach(e=>{console.log("FID:",e.processingStart-e.startTime)})}).observe({entryTypes:["first-input"]})}catch(t){}}},optimizeScrollPerformance(){let e=!1;const t=()=>{this.updateVisibilityStates(),this.updateScrollProgress(),e=!1};window.addEventListener("scroll",()=>{e||(requestAnimationFrame(t),e=!0)},{passive:!0})},updateVisibilityStates(){const e=document.querySelector(".header-inner");if(e){const t=window.pageYOffset,n=2*e.offsetHeight;t>n?e.classList.add("is-fixed"):e.classList.remove("is-fixed","show")}},updateScrollProgress(){const e=document.querySelector(".reading-progress");if(e){const t=window.pageYOffset,n=document.documentElement.scrollHeight-window.innerHeight,o=t/n*100;e.style.width=`${Math.min(o,100)}%`}},setupPrefetching(){const e=document.querySelector(".blog-pager .next");e&&this.prefetchOnIdle(e.href),setTimeout(()=>{document.querySelectorAll(".popular-posts a, .trending a").forEach((e,t)=>{t<3&&setTimeout(()=>this.prefetchOnIdle(e.href),1e3*t)})},3e3)},prefetchOnIdle(e){"requestIdleCallback"in window?requestIdleCallback(()=>{this.prefetchResource(e)}):setTimeout(()=>this.prefetchResource(e),2e3)},prefetchResource(e){const t=document.createElement("link");t.rel="prefetch",t.href=e,document.head.appendChild(t)},updatePerformanceMetrics(){const e=performance.now()-this.metrics.loadStart;"complete"===document.readyState&&this.metrics.imagesLoaded===this.metrics.totalImages&&console.log("Page Performance Metrics:",{totalLoadTime:e,imagesLoaded:this.metrics.imagesLoaded,domContentLoaded:performance.timing.domContentLoadedEventEnd-performance.timing.navigationStart,firstPaint:performance.getEntriesByType("paint")[0]?.startTime||"N/A"})},inlineCriticalCSS(){const e=document.createElement("style");e.textContent="\n                .header-inner { transition: transform 0.3s ease; }\n                .main-nav { will-change: transform; }\n                .post { contain: layout; }\n                .thumbnail { background-size: cover; background-position: center; }\n            ",document.head.insertBefore(e,document.head.firstChild)},cleanup(){this.intersectionObserver&&this.intersectionObserver.disconnect()}};e.PBTPerformance=t,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>t.init()):t.init()}(window);
